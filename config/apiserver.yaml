
apiVersion: apiregistration.k8s.io/v1beta1
kind: APIService
metadata:
  name: v1alpha1.devops.kubesphere.io
  labels:
    api: s2iapiserver
    apiserver: "true"
spec:
  version: v1alpha1
  group: devops.kubesphere.io
  groupPriorityMinimum: 2000
  service:
    name: s2iapiserver
    namespace: devops
  versionPriority: 10
  caBundle: "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURyakNDQXBhZ0F3SUJBZ0lKQU9XeUwwODJNMTlxTUEwR0NTcUdTSWIzRFFFQkN3VUFNR3d4Q3pBSkJnTlYKQkFZVEFuVnVNUXN3Q1FZRFZRUUlEQUp6ZERFS01BZ0dBMVVFQnd3QmJERUtNQWdHQTFVRUNnd0JiekVMTUFrRwpBMVVFQ3d3Q2IzVXhLekFwQmdOVkJBTU1Jbk15YVdGd2FYTmxjblpsY2kxalpYSjBhV1pwWTJGMFpTMWhkWFJvCmIzSnBkSGt3SGhjTk1UZ3hNVE13TURnME1ERTRXaGNOTVRreE1UTXdNRGcwTURFNFdqQnNNUXN3Q1FZRFZRUUcKRXdKMWJqRUxNQWtHQTFVRUNBd0NjM1F4Q2pBSUJnTlZCQWNNQVd3eENqQUlCZ05WQkFvTUFXOHhDekFKQmdOVgpCQXNNQW05MU1Tc3dLUVlEVlFRRERDSnpNbWxoY0dselpYSjJaWEl0WTJWeWRHbG1hV05oZEdVdFlYVjBhRzl5CmFYUjVNSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQXMzVHMrVXVNWElwdGJpdU0KMTBTc2JTV1pMdjJ6UjJJTUNoLzBBalZMeCtHSTN1c2xjNXVjMFNTUDlESlp4eFcveUZRVkwyY2lLTkVCRWplSApNSGNEbXNlVFFJUVZEREpGbDFUeGwwM3ZZcjhQLzczdVRXc2E4WXFaZGJaUmNhckp4VGRpU1R4TnBDcitLYitvCjhBUlFWNDJPb2xlaUZ3eHRXUEVZaGFkb0dpOUNKdEJ2SkpVYjVXb3BjMEFJTzNiZ2lWR0hZMkFGaWxlYzcxQlYKWXVnaThmcEpVRmhOMnBCdmw0NHo0cDhzREJUdFhFemovSkJ0UDNxS3JOTFBVaFI5NUUycHZlN21WaU1KeE4xMgpXcEhpU210MSsxVCthTUtua0J6OTAyTGlnQUxPdVlRK1IzZmk3cVJZMHJ5TEtVZ2FDMVpMVUs0eTdpdC83THN3Cmg2MG9mUUlEQVFBQm8xTXdVVEFkQmdOVkhRNEVGZ1FVL3ZBQ2ovUDNZQi90cWFjVG9CVXVvYk1wK05Nd0h3WUQKVlIwakJCZ3dGb0FVL3ZBQ2ovUDNZQi90cWFjVG9CVXVvYk1wK05Nd0R3WURWUjBUQVFIL0JBVXdBd0VCL3pBTgpCZ2txaGtpRzl3MEJBUXNGQUFPQ0FRRUFaNzduREduQWpGbTVDdmlUTVhYVDkrODMwc3Jwanp0anZ6UW1rL3RHCnNuWFM5dThuQ1ZSdkpHY29ET1E4RVA4OVR4QngrYlhXd3Rybk1rMzR0VXA2Z3ZMc2xwSXg2NjRLdmF6TDlNNUEKVmVxS3dNK0lwMmlJVEFSZ0dBbHVXbDRVWHIrZktjL1NXRnd3QldnTWdYVEFMdGowVEVHczdnNFZlemZTYm5OZApxcTZEWS9SMWRjdHZaRDZTRWNwWHJmb1JXYTlJaitBbTRUN01GTXJ0UUFmc1VxNHFNbGRpTHFLaFZaRGR4VXA1ClZlRkt4U2YrcEZ5RFh5clNJaSt2N1RlUUh3OHh4S3dmajZIMlVybVNzNjF5enptcFVVM2M2SXlmenJ4RHorNWQKR0FOMHIzSXhFMk5kUnVzT2Y2VitCcFgxYXZma0xsRDRqS3lxNkExdWhvK0ljUT09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K"
---
apiVersion: v1
kind: Service
metadata:
  name: s2iapiserver
  namespace: devops
  labels:
    api: s2iapiserver
    apiserver: "true"
spec:
  ports:
  - port: 443
    protocol: TCP
    targetPort: 443
  selector:
    api: s2iapiserver
    apiserver: "true"
---
apiVersion: apps/v1beta1
kind: Deployment
metadata:
  name: s2iapiserver
  namespace: devops
  labels:
    api: s2iapiserver
    apiserver: "true"
spec:
  replicas: 1
  template:
    metadata:
      labels:
        api: s2iapiserver
        apiserver: "true"
    spec:
      imagePullSecrets:
      - name: s2i-pull-secret
      serviceAccount: s2i-service-account
      containers:
      - name: apiserver
        image: dockerhub.qingcloud.com/magicsong/s2iapiserver:93f63fd5
        volumeMounts:
        - name: apiserver-certs
          mountPath: /apiserver.local.config/certificates
          readOnly: true
        command:
        - "./apiserver"
        args:
        - "--etcd-servers=http://etcd-svc:2379"
        - "--tls-cert-file=/apiserver.local.config/certificates/tls.crt"
        - "--tls-private-key-file=/apiserver.local.config/certificates/tls.key"
        - "--audit-log-path=-"
        - "--audit-log-maxage=0"
        - "--audit-log-maxbackup=0"
        - "--loglevel=3"
        resources:
          requests:
            cpu: 100m
            memory: 20Mi
          limits:
            cpu: 100m
            memory: 30Mi
      - name: controller
        image: dockerhub.qingcloud.com/magicsong/s2iapiserver:93f63fd5
        command:
        - "./controller-manager"
        args:
        - "-v=3"
        - "-logtostderr=true"
        resources:
          requests:
            cpu: 100m
            memory: 20Mi
          limits:
            cpu: 100m
            memory: 30Mi
      volumes:
      - name: apiserver-certs
        secret:
          secretName: s2iapiserver
---
apiVersion: apps/v1beta1
kind: StatefulSet
metadata:
  name: etcd
  namespace: devops
spec:
  serviceName: "etcd"
  replicas: 1
  template:
    metadata:
      labels:
        app: etcd
    spec:
      terminationGracePeriodSeconds: 10
      containers:
      - name: etcd
        image: quay.io/coreos/etcd:latest
        imagePullPolicy: Always
        resources:
          requests:
            cpu: 100m
            memory: 20Mi
          limits:
            cpu: 100m
            memory: 30Mi
        env:
        - name: ETCD_DATA_DIR
          value: /etcd-data-dir
        command:
        - /usr/local/bin/etcd
        - --listen-client-urls
        - http://0.0.0.0:2379
        - --advertise-client-urls
        - http://localhost:2379
        ports:
        - containerPort: 2379
        volumeMounts:
        - name: etcd-data-dir
          mountPath: /etcd-data-dir
        readinessProbe:
          httpGet:
            port: 2379
            path: /health
          failureThreshold: 1
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 2
        livenessProbe:
          httpGet:
            port: 2379
            path: /health
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 2
  volumeClaimTemplates:
  - metadata:
     name: etcd-data-dir
     annotations:
        volume.beta.kubernetes.io/storage-class: gluster-heketi
    spec:
      accessModes: [ "ReadWriteOnce" ]
      resources:
        requests:
         storage: 10Gi
---
apiVersion: v1
kind: Service
metadata:
  name: etcd-svc
  namespace: devops
  labels:
    app: etcd
spec:
  ports:
  - port: 2379
    name: etcd
    targetPort: 2379
  selector:
    app: etcd
---
apiVersion: v1
kind: Secret
type: kubernetes.io/tls
metadata:
  name: s2iapiserver
  namespace: devops
  labels:
    api: s2iapiserver
    apiserver: "true"
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURTakNDQWpJQ0NRRE9VdXhZRm5RWlpqQU5CZ2txaGtpRzl3MEJBUXNGQURCc01Rc3dDUVlEVlFRR0V3SjEKYmpFTE1Ba0dBMVVFQ0F3Q2MzUXhDakFJQmdOVkJBY01BV3d4Q2pBSUJnTlZCQW9NQVc4eEN6QUpCZ05WQkFzTQpBbTkxTVNzd0tRWURWUVFERENKek1tbGhjR2x6WlhKMlpYSXRZMlZ5ZEdsbWFXTmhkR1V0WVhWMGFHOXlhWFI1Ck1CNFhEVEU0TVRFek1EQTROREF4T0ZvWERURTVNVEV6TURBNE5EQXhPRm93WWpFTE1Ba0dBMVVFQmhNQ2RXNHgKQ3pBSkJnTlZCQWdNQW5OME1Rb3dDQVlEVlFRSERBRnNNUW93Q0FZRFZRUUtEQUZ2TVFzd0NRWURWUVFMREFKdgpkVEVoTUI4R0ExVUVBd3dZY3pKcFlYQnBjMlZ5ZG1WeUxtUmxabUYxYkhRdWMzWmpNSUlCSWpBTkJna3Foa2lHCjl3MEJBUUVGQUFPQ0FROEFNSUlCQ2dLQ0FRRUFwdWtGUGFGRXF5ZlcrcENzSEJHL0xVWVlWVXYvT3QrcE1RQlYKUHQyeHdQaVBLcG5EK0poSHlOSEJacVNPbk0wVnRwYk9NdkhxeC8yV0dnQkp5TXhoNjM4T1FpOXE3cThxMnFrVwp5SGVtRU55b3dDcW9yNVhFVFpkbGNDUHl3Wk5pcUlCZVI5UjBMT0p6Q3o0eURYeVNCMThsZTdtYmUzM3p5RFRrClB5YWo2UUNWNFkxTytzQ09EZjJKeFhXS0QrSW9ia1R2bm9JQjl3RUhGNERYSHovc0E1dXJkR3RLbXVvMFpCYVYKMmZyTXhrd0FqNERDZjFnL1IycjlZNEE1RkZQSW9BcUxaSzFjbjgxclFDeEtGcEJUa042VERoUmJqMFlxcDFnUgpXMHNRK3ZsbHV1eUFWSlZCQzdHOTE3blQ0Q2hpYytYTnJqcHZ6SmlLVXJWMDRndlFqUUlEQVFBQk1BMEdDU3FHClNJYjNEUUVCQ3dVQUE0SUJBUUE3K0J2ZGE5cTJDbHVMMVhnbU10b04vaGxhNU9YUU1ybkxqT2plNlkxRERzbjAKc3Vxc2NjVTNBNVdKeGhkNUR4bjhpVFBnVXE4K2YrQURRdW50QUQ0T3ZYOWtRaVh5eUtEekxyZmFZT1FGanV5Zgp5RzVJODhNVUJVSklzUzBXREFlbTlqUzlTNm9jZCsrUnZZQ3FFOUZDM1A0dWh5d1JwYXphSW11bUJrNUkxVkpXCkJvLzdMZlA4MThMYjlJbUNqdzc0OGNCVGRwSTRrcHEvcjRaRnRJb29OUXRkL0oyMkEvNktGZ3NzVG5qNUtPaXYKdkZPMm9WUWZGS003UzB1RDNPV2lkRUlsVVIxc3NORVZ6MkdFMmROaXRxajNIUjRIS3J0Y3hTVHdkWEhaNml1aApKdXR6cVpoWCszYnE3dnYva0doOFVneXV3eE50Vmp0c1J2OW5vb2NKCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
  tls.key: LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2Z0lCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktnd2dnU2tBZ0VBQW9JQkFRQ202UVU5b1VTcko5YjYKa0t3Y0ViOHRSaGhWUy84NjM2a3hBRlUrM2JIQStJOHFtY1A0bUVmSTBjRm1wSTZjelJXMmxzNHk4ZXJIL1pZYQpBRW5JekdIcmZ3NUNMMnJ1cnlyYXFSYklkNllRM0tqQUtxaXZsY1JObDJWd0kvTEJrMktvZ0Y1SDFIUXM0bk1MClBqSU5mSklIWHlWN3VadDdmZlBJTk9RL0pxUHBBSlhoalU3NndJNE4vWW5GZFlvUDRpaHVSTytlZ2dIM0FRY1gKZ05jZlArd0RtNnQwYTBxYTZqUmtGcFhaK3N6R1RBQ1BnTUovV0Q5SGF2MWpnRGtVVThpZ0NvdGtyVnlmeld0QQpMRW9Xa0ZPUTNwTU9GRnVQUmlxbldCRmJTeEQ2K1dXNjdJQlVsVUVMc2IzWHVkUGdLR0p6NWMydU9tL01tSXBTCnRYVGlDOUNOQWdNQkFBRUNnZ0VBR0tTV3pYNmQ4TmMwK2xHWjE1c1hLc3dLazYxZ3hZUjRLbS91SmhYOVJJeHUKTnMvMUN5TVFsaW5COERHampLc0s1YVptVTBjOGJzS1dBc2pBSEJGdzg2QVNydHJwWXN3aCs1NnphbTJmNnlWcApGTlkzaVpVSElwMlRzSGJlUkk1S0pxNnRQTlcxUVZzOXVRODV2SndEdzJyYzBlT1pmU1lmZEJPN0QwZlpNM0ZSCm5tdENnVVVlRkoveUhJT2F6QWZRQXRGWlJSL2RST0dlRVdHMWxta2d3YjF6aDBDTjZYR1I4QkI4TUVwMlZzTVAKRzdKYTJuTEl2bUpuS0hHYUt3bE85Y3RVbThvc1lOZ0hJdGg2Z3NkT0czM0M5MGFhUjZqSElpVEVtVElSMUwzdwpIY3FFM3IvN3RvdmJsb1RRRFh5RmhKRXB2K01uYkZyOFV4bXR1UDBwZ1FLQmdRRFZJZDUvWnZRSFpHOFdZVnBPCjZjNmkzSmZDcVdvaFQwSlRaNTlSLzRjdWp3bUxtMkVXK2lXdjJnK3V1Q1YvSUQrcmlwQ3IyT2ExWkw4bGtqRm4KZ0EyN3dXYjhnSC93anFld3NwS09jdUZCaDZJOEw0R21aNFZCa21rMUkraGhSVzJjVUtiOWEzTWJlc1RJUW92Vgo4M1lLVGZicTA3UHhDbU9BL0I1V0hiNktwUUtCZ1FESWV6QTNFRjZXUjJaRTY0V2JkbS9veEZVZnFkR21VdVpQClNDeXZqdUE4ZXR5elA3RVFIMXBJTEdqLzRDWXhYQ1NFZHFwSG9LOTRTWFFpNFhyR1BSV2lOOHJCMFhwYTh0NmMKdlR2VHJxUmJ1WXpQWVl3MS9yZUdEZk54czFpb2kxT1Jwb1kxVGZjNGpHTG02bHg5RWU3bm41QytOWU9uOEdRQgpxZE1hZG93UnlRS0JnUUNES1B1dTlhR1pad0pDQ0prMTFRYllETjdMNmN3cFFZaDBvV0ZYYWVROEQ4UjFDS0xnCkxBTERUSE80TnhURVBnbFF2TTQ1SXhzZmFDZUZySWtBdzdvdjRGNUxaNXpVWWtYcUpJcXlaUm9nWktLL1hSRHgKWWVXTXE5aFkzb2NrVFVDZUlMZ1RYbXVRN3FWcEJDTGdBSnFVenRQMFFXSU1KVE9FN2lLUkptN2JEUUtCZ0R1WApJa1c3ditHN1oxS2xEeG1lb3JUMVpyZjZxaTVlQmNjYkZPMDU4cjBIYUFKL3RBbXV5QThiNURucVRtL3RpNDAwCkdIa2g4Z1kzRHlZdkQyZE5VTmplN0kyZnpsYXFTakVjcm1QRlRXVldTZHg2aWtxaVk3cWMrdmVZNzRscG9IVnkKb2dIR0l1M1VETEhHaDZkRlpWWER3Q3BKamRDbFM1U1MvZ1NucUFyQkFvR0JBS1ZtSDVHUnVWdW1LQlRrZUs0ZQpOQmduZEhzbms3Wm9lODFjS2NsaDM3QlNMN2JTbXFCdGNjK3NzWE1md3NiVitFalZzSkhmMlRZY2pDTjk2TWEwCitWcHhoMXZVeHhDd3E5MVNtUnZ5dTFvZWx6UFFhUkxQWXVjU1k0aU8yZjc1VXI3eWZQd3FvSHA4cnJaS284d0IKcU9tZGhwclNQUFlYUW54RHBGMmtoeVQ1Ci0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0K
